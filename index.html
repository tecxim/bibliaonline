<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3498db">
  <title>Leitura Bíblica Aleatória</title>
  <style>
    /* ===== VARIÁVEIS E RESET ===== */
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2c3e50;
      --light: #f8f9fa;
      --text: #333;
      --text-light: #7f8c8d;
      --border: #e0e0e0;
      --radius: 12px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ===== BASE ===== */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f0f8ff 0%, #e6f2ff 100%);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* ===== LAYOUT PRINCIPAL ===== */
    .container {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 750px;
      padding: 30px 25px;
      margin-top: 80px;
      margin-bottom: 20px;
    }

    h1 {
      text-align: center;
      color: var(--secondary);
      font-weight: 600;
      font-size: 1.6rem;
      margin-bottom: 25px;
    }

    /* ===== MENU SUPERIOR ===== ALTEREI AQUI*/
    .menu-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: white;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      z-index: 1000;
      padding: 12px 20px;
    }

    .menu-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .menu {
      position: relative;
    }

    .menu-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--primary);
      color: white;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 500;
      transition: var(--transition);
      white-space: nowrap;
      text-align: center;
      border: none;
      cursor: pointer;
      font-size: 0.98rem;
    }

    .menu-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .menu-content {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      min-width: 260px;
      border-radius: 8px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: var(--transition);
      z-index: 1001;
      margin-top: 8px;
    }

    .menu:hover .menu-content {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .menu-content a {
      display: block;
      padding: 12px 18px;
      color: var(--text);
      text-decoration: none;
      border-bottom: 1px solid #f0f0f0;
      transition: var(--transition);
    }

    .menu-content a:hover {
      background: #f8f9fa;
      color: var(--primary);
    }

    .menu-content a:last-child {
      border-bottom: none;
    }

    /* ===== SELEÇÃO DE IDIOMA - MELHORADO ===== */
    .language-selector {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 25px;
      width: 100%;
    }

    .language-btn {
      padding: 12px 24px;
      background: #95a5a6;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      font-size: 1rem;
      flex: 1;
      max-width: 200px;
      min-width: 120px;
      text-align: center;
    }

    .language-btn.active {
      background: var(--primary);
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
    }

    .language-btn:hover:not(.active) {
      background: #7f8c8d;
      transform: translateY(-1px);
    }

    /* ===== CONTEÚDO DA BÍBLIA ===== */
    .reference {
      text-align: center;
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--primary);
    }

    .chapter-text {
      background: var(--light);
      padding: 25px;
      border-radius: 10px;
      border: 1px solid var(--border);
      line-height: 1.8;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
      font-size: 1.1rem;
      margin-bottom: 25px;
    }

    /* ===== BOTÕES ===== */
    .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    button {
      padding: 14px 24px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      min-width: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    button:active {
      transform: translateY(0);
    }

    /* ===== RODAPÉ ===== */
    footer {
      text-align: center;
      margin-top: 25px;
      color: var(--text-light);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .share-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    /* ===== BARRA DE ROLAGEM ===== */
    .chapter-text::-webkit-scrollbar {
      width: 8px;
    }

    .chapter-text::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .chapter-text::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .chapter-text::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    /* ===== ANIMAÇÕES ===== */
    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    /* ===== RESPONSIVIDADE ===== */
    
    /* Tablets */
    @media (max-width: 768px) {
      .container {
        padding: 25px 20px;
        margin-top: 70px;
      }
      
      h1 {
        font-size: 1.4rem;
      }
      
      .reference {
        font-size: 1.2rem;
      }
      
      .chapter-text {
        font-size: 1.05rem;
        padding: 20px;
        max-height: 50vh;
      }
      
      button {
        padding: 12px 20px;
        font-size: 0.95rem;
        min-width: 140px;
      }
      
      .menu-wrapper {
        gap: 15px;
      }
      
      .menu-btn {
        padding: 9px 15px;
        font-size: 0.9rem;
      }
      
      .language-btn {
        padding: 11px 20px;
        font-size: 0.95rem;
        max-width: 180px;
      }
    }

    /* Celulares */
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 20px 15px;
        margin-top: 70px;
        margin-bottom: 15px;
      }
      
      h1 {
        font-size: 1.3rem;
        margin-bottom: 20px;
      }
      
      .reference {
        font-size: 1.1rem;
      }
      
      .chapter-text {
        font-size: 1rem;
        padding: 18px;
        max-height: 55vh;
      }
      
      .buttons {
        gap: 12px;
      }
      
      button {
        width: 100%;
        max-width: 280px;
        padding: 13px 20px;
      }
      
      /* MENU - LADO A LADO SEMPRE */
      .menu-container {
        padding: 10px 15px;
      }
      
      .menu-wrapper {
        gap: 12px;
        justify-content: center;
        flex-wrap: nowrap;
      }
      
      .menu-btn {
        padding: 8px 14px;
        font-size: 0.85rem;
        min-width: 120px;
        flex: 1;
        max-width: 160px;
      }
      
      .menu-content {
        min-width: 220px;
        left: 50%;
        transform: translateX(-50%) translateY(-10px);
      }
      
      .menu:hover .menu-content {
        transform: translateX(-50%) translateY(0);
      }
      
      /* BOTÕES DE IDIOMA - SEMPRE NA HORIZONTAL */
      .language-selector {
        gap: 10px;
        padding: 0 5px;
      }
      
      .language-btn {
        padding: 10px 16px;
        font-size: 0.9rem;
        max-width: none;
        flex: 1;
        min-width: 100px;
      }
      
      footer {
        font-size: 0.85rem;
      }
    }

    /* Celulares muito pequenos */
    @media (max-width: 360px) {
      .menu-wrapper {
        gap: 8px;
      }
      
      .menu-btn {
        padding: 7px 12px;
        font-size: 0.8rem;
        min-width: 110px;
      }
      
      .container {
        padding: 18px 12px;
      }
      
      .language-selector {
        gap: 8px;
      }
      
      .language-btn {
        padding: 9px 12px;
        font-size: 0.85rem;
        min-width: 90px;
      }
    }

    /* Garantir que os botões de idioma nunca quebrem linha */
    .language-selector {
      flex-wrap: nowrap;
    }
  </style>
</head>
<body>
  <!-- Menu Superior -->
  <div class="menu-container">
    <div class="menu-wrapper">
      <!-- Menu Books and eBooks -->
      <div class="menu">
        <div class="menu-btn">Books and eBooks</div>
        <div class="menu-content">
          <a href="https://www.amazon.com/dp/B0FW58HKDC" target="_blank">
            How to Let God Use You (Amazon.com - EN)
          </a>
          <a href="https://www.amazon.com.br/dp/B0FVTTBN52" target="_blank">
            Como Deixar Deus te Usar (Amazon.com.br - PT)
          </a>
        </div>
      </div>

      <!-- Menu Aprender a usar o app -->
      <div class="menu">
        <a href="https://youtu.be/dtuhJdC578U?si=OsNZeUiuPgVfBSrQ"
           target="_blank" class="menu-btn">
          Aprender a usar o app
        </a>
      </div>
    </div>
  </div>

  <!-- Conteúdo Principal -->
  <div class="container">
    <h1>Leitura Bíblica Aleatória</h1>
    
    <div class="language-selector">
      <button class="language-btn active" onclick="setLanguage('web')">Inglês (WEB)</button>
      <button class="language-btn" onclick="setLanguage('almeida')">Português (Almeida)</button>
    </div>
    
    <div class="reference" id="reference">Carregando referência...</div>
    <div class="chapter-text" id="chapterText">Por favor, aguarde...</div>
    
    <div class="buttons">
      <button onclick="loadRandomChapter()" id="loadButton">
        <span class="spinner" id="spinner" style="display: none;"></span>
        Ler outro capítulo
      </button>
    </div>
    
    <footer>
      <p>EN / PT: Bible available in English and Portuguese — public domain — no ad banners. / Bíblia disponível em Português e Inglês — domínio público — sem banners de anúncio.</p>
    </footer>
    
    <div class="share-container">
      <button id="shareBtn">📤 Share / Compartilhar</button>
    </div>
  </div>

  <script>
    let currentLanguage = 'web';
    const books = [
      { name: "Genesis", chapters: 50 },
      { name: "Exodus", chapters: 40 },
      { name: "Leviticus", chapters: 27 },
      { name: "Numbers", chapters: 36 },
      { name: "Deuteronomy", chapters: 34 },
      { name: "Joshua", chapters: 24 },
      { name: "Psalms", chapters: 150 },
      { name: "Proverbs", chapters: 31 },
      { name: "Isaiah", chapters: 66 },
      { name: "Matthew", chapters: 28 },
      { name: "Mark", chapters: 16 },
      { name: "Luke", chapters: 24 },
      { name: "John", chapters: 21 },
      { name: "Acts", chapters: 28 },
      { name: "Romans", chapters: 16 },
      { name: "Revelation", chapters: 22 }
    ];

    function setLanguage(lang) {
      currentLanguage = lang;
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.language-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
      loadRandomChapter();
    }

    function getRandomReference() {
      const book = books[Math.floor(Math.random() * books.length)];
      const chapter = Math.floor(Math.random() * book.chapters) + 1;
      return { book: book.name, chapter };
    }

    async function fetchChapter(book, chapter) {
      try {
        if (currentLanguage === 'almeida') {
          const url = `https://bible-api.com/${book}+${chapter}?translation=${currentLanguage}`;
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Não foi possível carregar a versão Almeida. Tente novamente.");
          }
          return await response.json();
        } else {
          const url = `https://bible-api.com/${book}+${chapter}?translation=${currentLanguage}`;
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Não foi possível carregar o capítulo. Tente novamente.");
          }
          return await response.json();
        }
      } catch (err) {
        throw new Error("Erro ao carregar o capítulo. Tente novamente.");
      }
    }

    function displayChapter(data) {
      if (currentLanguage === 'almeida') {
        if (data.error) {
          document.getElementById("reference").textContent = "Erro ao carregar a versão Almeida";
          document.getElementById("chapterText").textContent = "Não foi possível carregar a versão Almeida. Tente novamente ou use a versão em inglês.";
        } else {
          document.getElementById("reference").textContent = data.reference;
          const verses = data.verses.map(v => `${v.verse}. ${v.text.trim()}`).join("\n\n");
          document.getElementById("chapterText").textContent = verses;
        }
      } else {
        document.getElementById("reference").textContent = data.reference;
        const verses = data.verses.map(v => `${v.verse}. ${v.text.trim()}`).join("\n\n");
        document.getElementById("chapterText").textContent = verses;
      }
    }

    async function loadRandomChapter() {
      document.getElementById("reference").textContent = "Carregando referência...";
      document.getElementById("chapterText").textContent = "Carregando capítulo...";
      
      // Mostrar spinner e desativar botão
      const loadButton = document.getElementById('loadButton');
      const spinner = document.getElementById('spinner');
      loadButton.classList.add('loading');
      spinner.style.display = 'inline-block';
      
      try {
        const { book, chapter } = getRandomReference();
        const data = await fetchChapter(book, chapter);
        displayChapter(data);
      } catch (err) {
        document.getElementById("reference").textContent = "Erro";
        document.getElementById("chapterText").textContent = err.message;
        console.error(err);
      } finally {
        // Esconder spinner e reativar botão
        loadButton.classList.remove('loading');
        spinner.style.display = 'none';
      }
    }

    const shareBtn = document.getElementById('shareBtn');
    shareBtn.addEventListener('click', async () => {
      const shareData = {
        title: 'Bible Reading Site',
        text: 'Confira este site de leitura bíblica — disponível em inglês e português, domínio público e sem anúncios!',
        url: window.location.href
      };
      if (navigator.share) {
        try {
          await navigator.share(shareData);
          console.log('Conteúdo compartilhado com sucesso.');
        } catch (err) {
          console.error('Erro ao compartilhar:', err);
        }
      } else {
        // Fallback para navegadores que não suportam a API de compartilhamento
        navigator.clipboard.writeText(window.location.href)
          .then(() => {
            alert('Link copiado para a área de transferência: ' + window.location.href);
          })
          .catch(() => {
            alert('Copie este link: ' + window.location.href);
          });
      }
    });

    window.onload = loadRandomChapter;

    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registrado com sucesso.'))
        .catch(err => console.log('Erro ao registrar o Service Worker:', err));
    }
  </script>
  
<script>
(function() {
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzqwy44OE7peeKb0-_EgJ_F1FV03qB6g3hg0DxkU5IaAxvRfHINrZdCZTOFuB7DmdeD2g/exec";

  // Função para pegar o IP
  async function getIP() {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (error) {
      console.error("Erro ao pegar IP:", error);
      return "N/A";
    }
  }

  // Função para pegar a localização (latitude/longitude)
  function getLocation() {
    return new Promise((resolve) => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            resolve({
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            });
          },
          (error) => {
            console.error("Erro ao pegar localização:", error);
            resolve(null);
          }
        );
      } else {
        console.error("Geolocalização não é suportada.");
        resolve(null);
      }
    });
  }

  // Função para pegar cidade/estado/país a partir das coordenadas
  async function getLocationDetails(latitude, longitude) {
    try {
      const response = await fetch(
        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
      );
      const data = await response.json();
      return {
        city: data.address.city || data.address.town || data.address.village || "Desconhecido",
        state: data.address.state || "Desconhecido",
        country: data.address.country || "Desconhecido"
      };
    } catch (error) {
      console.error("Erro ao pegar detalhes da localização:", error);
      return { city: "N/A", state: "N/A", country: "N/A" };
    }
  }

  // Função para enviar todos os dados
  async function sendData() {
    const ip = await getIP();
    const location = await getLocation();

    let city = "N/A";
    let state = "N/A";
    let country = "N/A";

    if (location) {
      const details = await getLocationDetails(location.latitude, location.longitude);
      city = details.city;
      state = details.state;
      country = details.country;
    }

    const dados = {
      page: window.location.href,
      referrer: document.referrer || "Direto",
      userAgent: navigator.userAgent,
      ip: ip,
      latitude: location ? location.latitude : "N/A",
      longitude: location ? location.longitude : "N/A",
      city: city,
      state: state,
      country: country
    };

    fetch(WEB_APP_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    })
    .then(() => console.log("Dados enviados com sucesso!"))
    .catch(error => console.error("Erro ao enviar dados:", error));
  }

  sendData();
})();
</script>


