<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3498db">
  <title>Leitura BÃ­blica AleatÃ³ria</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f8ff;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      padding: 30px 20px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 750px;
      width: 95%;
      position: relative;
      margin-top: 80px;
      margin-bottom: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
      font-weight: 600;
      font-size: 1.4rem;
    }
    .reference {
      text-align: center;
      font-weight: bold;
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #3498db;
    }
    .chapter-text {
      line-height: 1.7;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
      background-color: #fdfdfd;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 12px 20px;
      background-color: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      min-width: 150px;
    }
    button:hover {
      background-color: #2980b9;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.85rem;
      color: #7f8c8d;
    }
    .menu {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }
    .menu-btn {
      background-color: #2ecc71;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    .menu-btn:hover {
      background-color: #27ae60;
    }
    .menu-content {
      display: none;
      position: fixed;
      background-color: #f9f9f9;
      min-width: 250px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      right: 20px;
      border-radius: 6px;
      overflow: hidden;
      top: 60px;
    }
    .menu-content a {
      color: #333;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
      border-bottom: 1px solid #ddd;
      transition: background-color 0.3s;
    }
    .menu-content a:hover {
      background-color: #f1f1f1;
    }
    .menu-btn:hover + .menu-content,
    .menu-content:hover {
      display: block;
    }
    .language-selector {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .language-btn {
      padding: 8px 16px;
      background-color: #95a5a6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .language-btn.active {
      background-color: #3498db;
    }
    .language-btn:hover:not(.active) {
      background-color: #7f8c8d;
    }
    @media (max-width: 600px) {
      .container {
        padding: 20px 15px;
        margin-top: 70px;
      }
      h1 {
        font-size: 1.2rem;
      }
      .reference {
        font-size: 1.1rem;
      }
      .chapter-text {
        font-size: 1rem;
        padding: 15px;
      }
      button {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      .menu {
        top: 10px;
        right: 10px;
      }
      .menu-content {
        top: 50px;
        min-width: 200px;
      }
    }
    .share-container {
      display: flex;
      justify-content: center;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="menu">
    <div class="menu-btn">Books and eBooks</div>
    <div class="menu-content">
      <a href="https://www.amazon.com/dp/B0FW58HKDC" target="_blank">
        How to Let God Use You (Amazon.com - EN)
      </a>
      <a href="https://youtu.be/dtuhJdC578U?si=sBQ0lTe-ZgXMvpUh" target="_blank">
        Como Deixar Deus te Usar (Amazon.com.br - PT)
      </a>
    </div>
    <div class="menu-btn" onclick="showHelp()">Aprender a usar o app</div>
  </div>
  <div class="container">
    <h1>Leitura BÃ­blica AleatÃ³ria</h1>
    <div class="language-selector">
      <button class="language-btn active" onclick="setLanguage('web')">InglÃªs (WEB)</button>
      <button class="language-btn" onclick="setLanguage('almeida')">PortuguÃªs (Almeida)</button>
    </div>
    <div class="reference" id="reference">Carregando referÃªncia...</div>
    <div class="chapter-text" id="chapterText">Por favor, aguarde...</div>
    <div class="buttons">
      <button onclick="loadRandomChapter()">Ler outro capÃ­tulo</button>
    </div>
    <footer>
      <p>EN / PT: Bible available in English and Portuguese â€” public domain â€” no ad banners. / BÃ­blia disponÃ­vel em PortuguÃªs e InglÃªs â€” domÃ­nio pÃºblico â€” sem banners de anÃºncio.</p>
    </footer>
    <div class="share-container">
      <button id="shareBtn">ðŸ“¤ Share / Compartilhar</button>
    </div>
  </div>

  <script>
    let currentLanguage = 'web';

    const books = [
      { name: "Genesis", chapters: 50 },
      { name: "Exodus", chapters: 40 },
      { name: "Leviticus", chapters: 27 },
      { name: "Numbers", chapters: 36 },
      { name: "Deuteronomy", chapters: 34 },
      { name: "Joshua", chapters: 24 },
      { name: "Psalms", chapters: 150 },
      { name: "Proverbs", chapters: 31 },
      { name: "Isaiah", chapters: 66 },
      { name: "Matthew", chapters: 28 },
      { name: "Mark", chapters: 16 },
      { name: "Luke", chapters: 24 },
      { name: "John", chapters: 21 },
      { name: "Acts", chapters: 28 },
      { name: "Romans", chapters: 16 },
      { name: "Revelation", chapters: 22 }
    ];

    function setLanguage(lang) {
      currentLanguage = lang;
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.language-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
      loadRandomChapter();
    }

    function getRandomReference() {
      const book = books[Math.floor(Math.random() * books.length)];
      const chapter = Math.floor(Math.random() * book.chapters) + 1;
      return { book: book.name, chapter };
    }

    async function fetchChapter(book, chapter) {
      try {
        if (currentLanguage === 'almeida') {
          // Usa a API original para Almeida (mesmo que nÃ£o funcione perfeitamente)
          const url = `https://bible-api.com/${book}+${chapter}?translation=${currentLanguage}`;
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("NÃ£o foi possÃ­vel carregar a versÃ£o Almeida. Tente novamente.");
          }
          return await response.json();
        } else {
          // Usa a API para WEB (inglÃªs)
          const url = `https://bible-api.com/${book}+${chapter}?translation=${currentLanguage}`;
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("NÃ£o foi possÃ­vel carregar o capÃ­tulo. Tente novamente.");
          }
          return await response.json();
        }
      } catch (err) {
        throw new Error("Erro ao carregar o capÃ­tulo. Tente novamente.");
      }
    }

    function displayChapter(data) {
      if (currentLanguage === 'almeida') {
        if (data.error) {
          document.getElementById("reference").textContent = "Erro ao carregar a versÃ£o Almeida";
          document.getElementById("chapterText").textContent = "NÃ£o foi possÃ­vel carregar a versÃ£o Almeida. Tente novamente ou use a versÃ£o em inglÃªs.";
        } else {
          document.getElementById("reference").textContent = data.reference;
          const verses = data.verses.map(v => `${v.verse}. ${v.text.trim()}`).join("\n\n");
          document.getElementById("chapterText").textContent = verses;
        }
      } else {
        document.getElementById("reference").textContent = data.reference;
        const verses = data.verses.map(v => `${v.verse}. ${v.text.trim()}`).join("\n\n");
        document.getElementById("chapterText").textContent = verses;
      }
    }

    async function loadRandomChapter() {
      document.getElementById("reference").textContent = "Carregando referÃªncia...";
      document.getElementById("chapterText").textContent = "Carregando capÃ­tulo...";
      try {
        const { book, chapter } = getRandomReference();
        const data = await fetchChapter(book, chapter);
        displayChapter(data);
      } catch (err) {
        document.getElementById("reference").textContent = "Erro";
        document.getElementById("chapterText").textContent = err.message;
        console.error(err);
      }
    }

    function showHelp() {
      alert("Para usar o app:\n1. Clique em 'Ler outro capÃ­tulo' para carregar um capÃ­tulo aleatÃ³rio.\n2. Escolha o idioma (InglÃªs ou PortuguÃªs).\n3. Use o menu para acessar livros e eBooks relacionados.");
    }

    const shareBtn = document.getElementById('shareBtn');
    shareBtn.addEventListener('click', async () => {
      const shareData = {
        title: 'Bible Reading Site',
        text: 'Confira este site de leitura bÃ­blica â€” disponÃ­vel em inglÃªs e portuguÃªs, domÃ­nio pÃºblico e sem anÃºncios!',
        url: window.location.href
      };
      if (navigator.share) {
        try {
          await navigator.share(shareData);
          console.log('ConteÃºdo compartilhado com sucesso.');
        } catch (err) {
          console.error('Erro ao compartilhar:', err);
        }
      } else {
        alert('Compartilhamento nÃ£o Ã© suportado neste dispositivo. Copie este link: ' + window.location.href);
      }
    });

    window.onload = loadRandomChapter;
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registrado com sucesso.'))
        .catch(err => console.log('Erro ao registrar o Service Worker:', err));
    }
  </script>
</body>
</html>
